<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="memberFee">
	<typeAlias alias="memberFee" type="com.pay.poss.report.dto.MemberFeeDTO"/>
    <resultMap id="memberFee" class="com.pay.poss.report.dto.MemberFeeDTO">
        <result column="FI_MOBILE_POS_COUNT" property="fiMobilePosCount" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_REFUND_FEE" property="fiDepositRefundFee" jdbcType="DECIMAL"/>
        <result column="FO_WITHDROW_FEE" property="foWithdrowFee" jdbcType="DECIMAL"/>
        <result column="FO_ACC_OUT_FEE" property="foAccOutFee" jdbcType="DECIMAL"/>
        <result column="REFUND_COUNT" property="refundCount" jdbcType="DECIMAL"/>
        <result column="REFUND_FEE" property="refundFee" jdbcType="DECIMAL"/>
        <result column="FI_MOBILE_POS_FEE" property="fiMobilePosFee" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_FEE" property="fiDepositFee" jdbcType="DECIMAL"/>
        <result column="MEMBER_TYPE" property="memberType" jdbcType="DECIMAL"/>
        <result column="FO_ACC_OUT_COUNT" property="foAccOutCount" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_REFUND_COUNT" property="fiDepositRefundCount" jdbcType="DECIMAL"/>
        <result column="ALL_COUNT" property="allCount" jdbcType="DECIMAL"/>
        <result column="FO_BANK_FEE" property="foBankFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_IN_FEE" property="fiAccInFee" jdbcType="DECIMAL"/>
        <result column="NAME" property="name" jdbcType="VARCHAR"/>
        <result column="FI_PREPAID_CARD_COUNT" property="fiPrepaidCardCount" jdbcType="DECIMAL"/>
        <result column="BANK_WITHHOLDING_FEE" property="bankWithholdingFee" jdbcType="DECIMAL"/>
        <result column="REPORT_DATE" property="reportDate" jdbcType="TIMESTAMP"/>
        <result column="FO_ACC_IN_COUNT" property="foAccInCount" jdbcType="DECIMAL"/>
        <result column="CREATE_DATE" property="createDate" jdbcType="TIMESTAMP"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="FI_CONSUME_CARD_COUNT" property="fiConsumeCardCount" jdbcType="DECIMAL"/>
        <result column="FI_BANK_FEE" property="fiBankFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_OUT_FEE" property="fiAccOutFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_IN_COUNT" property="fiAccInCount" jdbcType="DECIMAL"/>
        <result column="FO_BANK_COUNT" property="foBankCount" jdbcType="DECIMAL"/>
        <result column="ALL_FEE" property="allFee" jdbcType="DECIMAL"/>
        <result column="BANK_WITHHOLDING_COUNT" property="bankWithholdingCount" jdbcType="DECIMAL"/>
        <result column="FO_WITHDROW_COUNT" property="foWithdrowCount" jdbcType="DECIMAL"/>
        <result column="FI_PREPAID_CARD_FEE" property="fiPrepaidCardFee" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_COUNT" property="fiDepositCount" jdbcType="DECIMAL"/>
        <result column="FI_BANK_COUNT" property="fiBankCount" jdbcType="DECIMAL"/>
        <result column="SEQUENCE_ID" property="sequenceId" jdbcType="DECIMAL"/>
        <result column="REFUND_2_ACC_FEE" property="refund2AccFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_OUT_COUNT" property="fiAccOutCount" jdbcType="DECIMAL"/>
        <result column="REFUND_2_ACC_COUNT" property="refund2AccCount" jdbcType="DECIMAL"/>
        <result column="FO_ACC_IN_FEE" property="foAccInFee" jdbcType="DECIMAL"/>
        <result column="FI_CONSUME_CARD_FEE" property="fiConsumeCardFee" jdbcType="DECIMAL"/>
        <result column="CREDIT_QUICK_PAY_FEE" property="creditQuickPayFee" jdbcType="DECIMAL"/>
        <result column="CREDIT_QUICK_PAY_COUNT" property="creditQuickPayCount" jdbcType="DECIMAL"/>
        <result column="DEBIT_QUICK_PAY_FEE" property="debitQuickPayFee" jdbcType="DECIMAL"/>
        <result column="DEBIT_QUICK_PAY_COUNT" property="debitQuickPayCount" jdbcType="DECIMAL"/>
    </resultMap>
    
    <resultMap id="memberFeeList" class="com.pay.poss.report.dto.MemberFeeDTO">
        <result column="FI_MOBILE_POS_COUNT" property="fiMobilePosCount" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_REFUND_FEE" property="fiDepositRefundFee" jdbcType="DECIMAL"/>
        <result column="FO_WITHDROW_FEE" property="foWithdrowFee" jdbcType="DECIMAL"/>
        <result column="FO_ACC_OUT_FEE" property="foAccOutFee" jdbcType="DECIMAL"/>
        <result column="REFUND_COUNT" property="refundCount" jdbcType="DECIMAL"/>
        <result column="REFUND_FEE" property="refundFee" jdbcType="DECIMAL"/>
        <result column="FI_MOBILE_POS_FEE" property="fiMobilePosFee" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_FEE" property="fiDepositFee" jdbcType="DECIMAL"/>
        <result column="MEMBER_TYPE" property="memberType" jdbcType="DECIMAL"/>
        <result column="FO_ACC_OUT_COUNT" property="foAccOutCount" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_REFUND_COUNT" property="fiDepositRefundCount" jdbcType="DECIMAL"/>
        <result column="ALL_COUNT" property="allCount" jdbcType="DECIMAL"/>
        <result column="FO_BANK_FEE" property="foBankFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_IN_FEE" property="fiAccInFee" jdbcType="DECIMAL"/>
        <result column="NAME" property="name" jdbcType="VARCHAR"/>
        <result column="FI_PREPAID_CARD_COUNT" property="fiPrepaidCardCount" jdbcType="DECIMAL"/>
        <result column="BANK_WITHHOLDING_FEE" property="bankWithholdingFee" jdbcType="DECIMAL"/>
        <result column="REPORT_DATE" property="reportDate" jdbcType="TIMESTAMP"/>
        <result column="FO_ACC_IN_COUNT" property="foAccInCount" jdbcType="DECIMAL"/>
        <result column="CREATE_DATE" property="createDate" jdbcType="TIMESTAMP"/>
        <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
        <result column="FI_CONSUME_CARD_COUNT" property="fiConsumeCardCount" jdbcType="DECIMAL"/>
        <result column="FI_BANK_FEE" property="fiBankFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_OUT_FEE" property="fiAccOutFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_IN_COUNT" property="fiAccInCount" jdbcType="DECIMAL"/>
        <result column="FO_BANK_COUNT" property="foBankCount" jdbcType="DECIMAL"/>
        <result column="ALL_FEE" property="allFee" jdbcType="DECIMAL"/>
        <result column="BANK_WITHHOLDING_COUNT" property="bankWithholdingCount" jdbcType="DECIMAL"/>
        <result column="FO_WITHDROW_COUNT" property="foWithdrowCount" jdbcType="DECIMAL"/>
        <result column="FI_PREPAID_CARD_FEE" property="fiPrepaidCardFee" jdbcType="DECIMAL"/>
        <result column="FI_DEPOSIT_COUNT" property="fiDepositCount" jdbcType="DECIMAL"/>
        <result column="FI_BANK_COUNT" property="fiBankCount" jdbcType="DECIMAL"/>
        <result column="SEQUENCE_ID" property="sequenceId" jdbcType="DECIMAL"/>
        <result column="REFUND_2_ACC_FEE" property="refund2AccFee" jdbcType="DECIMAL"/>
        <result column="FI_ACC_OUT_COUNT" property="fiAccOutCount" jdbcType="DECIMAL"/>
        <result column="REFUND_2_ACC_COUNT" property="refund2AccCount" jdbcType="DECIMAL"/>
        <result column="FO_ACC_IN_FEE" property="foAccInFee" jdbcType="DECIMAL"/>
        <result column="FI_CONSUME_CARD_FEE" property="fiConsumeCardFee" jdbcType="DECIMAL"/>
        <result column="CREDIT_QUICK_PAY_FEE" property="creditQuickPayFee" jdbcType="DECIMAL"/>
        <result column="CREDIT_QUICK_PAY_COUNT" property="creditQuickPayCount" jdbcType="DECIMAL"/>
        <result column="DEBIT_QUICK_PAY_FEE" property="debitQuickPayFee" jdbcType="DECIMAL"/>
        <result column="DEBIT_QUICK_PAY_COUNT" property="debitQuickPayCount" jdbcType="DECIMAL"/>
        <result column="INNER_MEMBER_NAME" property="innerMemberName" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Column_List">
		FI_MOBILE_POS_COUNT,FI_DEPOSIT_REFUND_FEE,FO_WITHDROW_FEE,FO_ACC_OUT_FEE,REFUND_COUNT,
		REFUND_FEE,FI_MOBILE_POS_FEE,FI_DEPOSIT_FEE,MEMBER_TYPE,FO_ACC_OUT_COUNT,
		FI_DEPOSIT_REFUND_COUNT,ALL_COUNT,FO_BANK_FEE,FI_ACC_IN_FEE,NAME,
		FI_PREPAID_CARD_COUNT,BANK_WITHHOLDING_FEE,REPORT_DATE,FO_ACC_IN_COUNT,CREATE_DATE,
		MEMBER_CODE,FI_CONSUME_CARD_COUNT,FI_BANK_FEE,FI_ACC_OUT_FEE,FI_ACC_IN_COUNT,
		FO_BANK_COUNT,ALL_FEE,BANK_WITHHOLDING_COUNT,FO_WITHDROW_COUNT,FI_PREPAID_CARD_FEE,
		FI_DEPOSIT_COUNT,FI_BANK_COUNT,SEQUENCE_ID,REFUND_2_ACC_FEE,FI_ACC_OUT_COUNT,
		REFUND_2_ACC_COUNT,FO_ACC_IN_FEE,FI_CONSUME_CARD_FEE
    </sql>
    
    <select id="queryMemberFee" resultMap="memberFeeList">
        SELECT NVL(A.MEMBER_NAME, '/') INNER_MEMBER_NAME,
		       FEE.MEMBER_CODE MEMBER_CODE,
		       FEE.NAME NAME,
		       FEE.MEMBER_TYPE MEMBER_TYPE,
		       FEE.REPORT_DATE REPORT_DATE,
		       FEE.CREATE_DATE CREATE_DATE,
		       FEE.SEQUENCE_ID SEQUENCE_ID,
		       SUM(REFUND_2_ACC_FEE) REFUND_2_ACC_FEE,
		       SUM(REFUND_2_ACC_COUNT) REFUND_2_ACC_COUNT,
		       SUM(BANK_WITHHOLDING_FEE) BANK_WITHHOLDING_FEE,
		       SUM(BANK_WITHHOLDING_COUNT) BANK_WITHHOLDING_COUNT,
		       SUM(FO_ACC_IN_FEE) FO_ACC_IN_FEE,
		       SUM(FO_ACC_IN_COUNT) FO_ACC_IN_COUNT,
		       SUM(FI_MOBILE_POS_FEE) FI_MOBILE_POS_FEE,
		       SUM(FI_MOBILE_POS_COUNT) FI_MOBILE_POS_COUNT,
		       SUM(FI_CONSUME_CARD_FEE) FI_CONSUME_CARD_FEE,
		       SUM(FI_CONSUME_CARD_COUNT) FI_CONSUME_CARD_COUNT,
		       SUM(FI_PREPAID_CARD_FEE) FI_PREPAID_CARD_FEE,
		       SUM(FI_PREPAID_CARD_COUNT) FI_PREPAID_CARD_COUNT,
		       SUM(FI_BANK_FEE) FI_BANK_FEE,
		       SUM(FI_BANK_COUNT) FI_BANK_COUNT,
		       SUM(FI_ACC_IN_FEE) FI_ACC_IN_FEE,
		       SUM(FI_ACC_IN_COUNT) FI_ACC_IN_COUNT,
		       SUM(FI_DEPOSIT_FEE) FI_DEPOSIT_FEE,
		       SUM(FI_DEPOSIT_COUNT) FI_DEPOSIT_COUNT,
		       SUM(FI_ACC_OUT_FEE) FI_ACC_OUT_FEE,
		       SUM(FI_ACC_OUT_COUNT) FI_ACC_OUT_COUNT,
		       SUM(FO_ACC_OUT_FEE) FO_ACC_OUT_FEE,
		       SUM(FO_ACC_OUT_COUNT) FO_ACC_OUT_COUNT,
		       SUM(FO_BANK_FEE) FO_BANK_FEE,
		       SUM(FO_BANK_COUNT) FO_BANK_COUNT,
		       SUM(FO_WITHDROW_FEE) FO_WITHDROW_FEE,
		       SUM(FO_WITHDROW_COUNT) FO_WITHDROW_COUNT,
		       SUM(FI_DEPOSIT_REFUND_FEE) FI_DEPOSIT_REFUND_FEE,
		       SUM(FI_DEPOSIT_REFUND_COUNT) FI_DEPOSIT_REFUND_COUNT,
		       SUM(REFUND_FEE) REFUND_FEE,
		       SUM(REFUND_COUNT) REFUND_COUNT,
		       SUM(CREDIT_QUICK_PAY_FEE) CREDIT_QUICK_PAY_FEE,
		       SUM(CREDIT_QUICK_PAY_COUNT) CREDIT_QUICK_PAY_COUNT,
		       SUM(DEBIT_QUICK_PAY_FEE) DEBIT_QUICK_PAY_FEE,
		       SUM(DEBIT_QUICK_PAY_COUNT) DEBIT_QUICK_PAY_COUNT,
		       SUM(ALL_FEE) ALL_FEE,
		       SUM(ALL_COUNT) ALL_COUNT
		       
		  FROM INTRA.T_MEMBER_FEE FEE,
		       (SELECT F.MEMBER_CODE, F.MEMBER_NAME, S.MEMBER_CODE S_MEMBER_ID
		          FROM INTRA.T_INNER_MEMBER F, INTRA.T_SUB_MEMBER S
		         WHERE F.MEMBER_CODE = S.PARENT_ID) A
		 WHERE 
		<isEmpty property="isInnerMember">
            FEE.MEMBER_CODE = A.S_MEMBER_ID(+)
            <isNotEmpty prepend="AND" property="memberCode" >
            	FEE.MEMBER_CODE =#memberCode#
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="memberType" >
            	FEE.MEMBER_TYPE =#memberType#
            </isNotEmpty>
        </isEmpty>
        <isNotEmpty property="isInnerMember">
            FEE.MEMBER_CODE = A.S_MEMBER_ID
	        <isNotNull prepend="AND" property="memberCode">
	            A.MEMBER_CODE = #memberCode# 
	        </isNotNull>
        </isNotEmpty>
        <isNotNull prepend="AND" property="startDate">
           	<![CDATA[ FEE.REPORT_DATE >= to_date(#startDate#,'yyyy-MM-dd') ]]>
        </isNotNull>
        <isNotNull prepend="AND" property="endDate">
        	<![CDATA[ FEE.REPORT_DATE < to_date(#endDate#,'yyyy-MM-dd')+1 ]]>
       	</isNotNull>
        GROUP BY A.MEMBER_NAME, FEE.MEMBER_CODE, FEE.NAME, FEE.MEMBER_TYPE, FEE.REPORT_DATE, FEE.CREATE_DATE, FEE.SEQUENCE_ID
        ORDER BY FEE.MEMBER_CODE
    </select>

    <select id="queryMemberFee_COUNT"  resultClass="java.lang.Integer">
        SELECT count(1) FROM (SELECT 1
		  FROM INTRA.T_MEMBER_FEE FEE,
		       (SELECT F.MEMBER_CODE, F.MEMBER_NAME, S.MEMBER_CODE S_MEMBER_ID
		          FROM INTRA.T_INNER_MEMBER F, INTRA.T_SUB_MEMBER S
		         WHERE F.MEMBER_CODE = S.PARENT_ID) A 
		 WHERE 
		<isEmpty property="isInnerMember">
            FEE.MEMBER_CODE = A.S_MEMBER_ID(+)
            <isNotEmpty prepend="AND" property="memberCode" >
            	FEE.MEMBER_CODE =#memberCode#
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="memberType" >
            	FEE.MEMBER_TYPE =#memberType#
            </isNotEmpty>
        </isEmpty>
        <isNotEmpty property="isInnerMember">
            FEE.MEMBER_CODE = A.S_MEMBER_ID
	        <isNotNull prepend="AND" property="memberCode">
	            A.MEMBER_CODE = #memberCode# 
	        </isNotNull>
        </isNotEmpty>
        <isNotNull prepend="AND" property="startDate">
           	<![CDATA[ FEE.REPORT_DATE >= to_date(#startDate#,'yyyy-MM-dd') ]]>
        </isNotNull>
        <isNotNull prepend="AND" property="endDate">
        	<![CDATA[ FEE.REPORT_DATE < to_date(#endDate#,'yyyy-MM-dd')+1 ]]>
       	</isNotNull>
        GROUP BY A.MEMBER_NAME, FEE.MEMBER_CODE, FEE.NAME, FEE.MEMBER_TYPE, FEE.REPORT_DATE, FEE.CREATE_DATE, FEE.SEQUENCE_ID)
    </select>
</sqlMap>
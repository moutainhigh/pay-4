<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>iPayLinks支付手机充值</title>
<link href="<@sp.static/>/css/pay/public.css" rel="stylesheet" type="text/css">
<link href="<@sp.static/>/css/pay/steward.css" rel="stylesheet" type="text/css">
<link href="<@sp.static/>/css/dialog/jquery-ui.custom.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="<@sp.static/>/js/pay/common/jquery-1.3.2.js"></script>
<script type="text/javascript" src="<@sp.static/>/js/pay/common/plugins/jquery-ui.js"></script>
<script type="text/javascript" src="<@sp.static/>/js/pay/common/pay-dialog.js"></script>
<script type="text/javascript" src="<@sp.static/>/js/pay/app/appCommon.js" ></script>
</head>
<body>
<#escape x as x?html>
<!--导航 str-->
<@sp.ebillheader pagename="手机充值"/>
<!--导航 end--> 
<!--主内容 str -->
<div class="container"> 
	<!--侧导航 str -->
<@sp.ebillmenu channel="1_1"/>

	<!--侧导航 end -->
	<div class="box_main guide_page">
		<div class="mod_box_a">
			<p class="top"><i></i></p>
			<div class="con_box mob_recharge_con">
				<div class="big_tit">
					<h2>手机充值</h2>
					<p class="slogan">快充三十分钟内到账</p>
				</div>
				<div class="m_height">
					<form class="mod_form" action="${rc.contextPath}/mobileCharge.htm" method="post" id="command" name="command">
						<ul class="mob_recharge_form">
							<li>
								<label class="side">手机号码：</label>
								<input class="inp_normal" id="mobileNo" name="mobileNo" type="text" maxlength="12" value="${command.mobileNo?default('支持全国移动联通电信')}"  oncopy="return false" tabindex="1"/>
								<p class="mob_tips" id="mobile_address"></p>
								<p class="red mob_tips" style="display: none;color: rgb(255,0,0);" id="mobileNo_error"></p>
							</li>
							<li id="mobile_product_list">
								<label class="side">充值面额：</label>
								<input class="radio" name="" type="radio" value="">
								<label class="for_radio" for="">30元</label>
								<input class="radio" name="" type="radio" value="">
								<label class="for_radio" for="">50元</label>
								<input class="radio" name="" type="radio" value="">
								<label class="for_radio" for="">100元</label>
								<input class="radio" name="" type="radio" value="">
								<label class="for_radio" for="">150元</label>
							</li>
								<li>
								<label class="side">应付金额：</label>
								<strong class="red" id="show_amount"></strong><span id="amount_yuan"> </span>
								</li>
							<li><a class="btn_yel btn_go v_b" href="#" tabindex="3"><span id="submitForm">立即充值</span></a><a class="red ml10" href="${rc.contextPath}/mobileQuery.htm">充值记录查询</a></li>
						</ul>
					   <input type="hidden" name="bossType" id="bossType" value="${command.bossType?default('')}"/>
					   <input type="hidden" id="bossType_temp" value="${command.bossType?default('')}"/>
					   <input type="hidden" id="chargeAmount" value="${command.chargeAmount?default('')}"/>
					   <input type="hidden" id="chargeAmount_next" value=""/>
					   <input type="hidden" name="amount" id="amount" value="${command.amount?default('')}"/>
					   <input type="hidden" name="address" id="address" value="${command.address?default('')}"/>
					   <input type="hidden" name="provinceCode" id="provinceCode" value="${command.provinceCode?default('')}"/>
					</form>
					<dl class="text_guid">
						<dt>支持范围：</dt>
							<dd>支持全国各省市（澳门 香港 台湾地区除外)</dd>
							<dd>支持移动、电信、联通所有手机号码</dd>
							<dd>本充值不参加当地移动、电信、联通活动</dd>
					</dl>
					<dl class="text_guid minute_10">
						<dt>过去十分钟：</dt>
						<dd>
						<#if historyMobiles?exists>
						<div class="scroll">
						<#list historyMobiles as ls>
							<p><span class="red">${ls.MOBILENO}</span><span>花了</span> <span class="red">${ls.APPLYAMOUNT}元</span><span>给自己</span><span>手机快充</span></p>
						</#list>
						</div>
						<#else>
							<div class="scroll">
							<p><span class="red">135****1127</span><span>花了</span> <span class="red">50.00元</span><span>给自己</span><span>手机快充</span></p>
							<p><span class="red">139****1805</span><span>花了</span> <span class="red">100.00元</span><span>给自己</span><span>手机快充</span></p>
							<p><span class="red">137****2116</span><span>花了</span> <span class="red">50.00元</span><span>给自己</span><span>手机快充</span></p>
							</div>
						</#if>
						</dd>
					</dl>
					<div class="active_tips">
						<p class="tit_pic">
						<#if pageConfig?exists && pageConfig.imgHref?exists && pageConfig.imgHref != ''><a href="${pageConfig.imgHref}" target="_target"></#if>
						<img alt="" src="<@sp.static/><#if pageConfig?exists>${pageConfig.imgSrc?default('')}<#else>/img/pay/sample/ad_148_161_1.jpg</#if>">
						<#if pageConfig?exists && pageConfig.imgHref?exists && pageConfig.imgHref != ''></a></#if>
						</p>
					</div>
				</div>
				<!--步骤str-->
				<div class="step_mod">
					<dl>
						<dt>流程说明:</dt>
						<dd><i>1</i>填写信息</dd>
						<dd><i>2</i>确认信息</dd>
						<dd><i>3</i>成功提交订单</dd>
						<dd><i>4</i>手机充值成功</dd>
					</dl>
				</div>
				<!--步骤end--> 
				<!--问答 str-->
				<div class="mod_tit mt20">
					<h3 class="title font14"> <strong>有问题 我帮您</strong> </h3>
					<a class="more red" href="${rc.contextPath}/baseHelp.htm">更多帮助</a> </div>
				<dl class="ico_txtBox">
					<dt><i class="q_ico"></i>手机充值是24小时服务吗？</dt>
					<dd><i class="a_ico"></i>请放心iPayLinks支付支付手机充值是系统自动充值，24小时为您提供手机充值服务。 </dd>
					<dt><i class="q_ico"></i> 手机话费充值是否需要手续费？</dt>
					<dd><i class="a_ico"></i>iPayLinks支付生支付手机充值不但不需要手续费，而且价格优惠，30分钟内充值成功。</dd>
				</dl>	
		</div>
		<p class="bot"><i></i></p>
	</div>
</div>
<!--主内容 end --> 
<!--footer -->
</#escape>
<#include "/common/include/footer.html">
</body>
<#if msg?exists>
	<script type="text/javascript">	
		$(function(){	
			$.pay.alert('${msg?default('')}',{h:160,t:'3'});
		});
	</script>
</#if>
</html>
<script type="text/javascript">
$(document).ready(function(){
	  if($('#bossType').val() != "" && $('#bossType').val() != null){
		  loadMobileProduct();
		   //amount
		   $('#amount_yuan').html("")
		   $('#show_amount').html('');
		   $('#show_amount').html($('#amount').val());  // **
		   $('#amount_yuan').html(" 元");
           $('#mobile_address').html("所属："+$('#address').val());
      }else{
    	  //load default mobile product
    	  loadMobileProduct();
      }
	
});

$(document).ready(function(){
	//#mobileNo
    $('#mobileNo').keyup(function(e){
    	 var keyCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
    	 if(keyCode == 37 || keyCode == 39)
    	 {
        	  return false;
          }
    	$('#mobileNo_error').css({display:"none"});
    	$('#bossType_temp').val('');
    	if($(this).val().length==12){
            $(this).val($(this).val().substr(0,11));
            return false;
        }
    	$(this).val($(this).val().replace(/[^\d]/g,''));
    	if($(this).val().length ==11){
    		
           //get mobileNo segment
            $.ajax({
            	type:"GET",
                url:"${rc.contextPath}/mob_tel_segment.htm?method=selSegment&mobileNo="+$(this).val(),
                dataType:"JSON",
                success:function(data){
                    //show address
                	 $('#mobile_address').html({display:"block"});
                	 if(sm_r(data) ==""){
                         $('#mobile_address').html('暂不支持');
                     }else{
                   	   $('#mobile_address').html("所属："+sm_r(data));
                   	   $('#address').val(sm_r(data));
                    }
                       //show mobile product and discount
                	 if(data != null && data !="null"){
                    	 //clear chargeAmount
                		 $('#chargeAmount').val('');
                		 //show mobile product
                    	 loadMobileProduct();
                         
                     }
                   
                }
            });
                
        }else{
        	 $('#mobile_address').html('');
        }
        
     }).blur(function(){
         //
    	 //remove mobileNo class=inp_select
    	 $('#mobileNo').removeClass("inp_select");
    	 $('#mobileNo').addClass("inp_normal");
          if('' == $('#mobileNo').val() || null == $('#mobileNo').val() ){
               $('#mobileNo').val('支持全国移动联通电信');
               return false;
           }
           if($('#bossType_temp').val() == ""){
        	   eval($('#mobileNo').keyup());
           }
     }).focus(function(){
    	  $('#mobileNo_error').css({display:"none"});
    	  $('#mobile_address').css({display:"block"});
          //add mobielNo class=inp_select
          $('#mobileNo').removeClass();
          $('#mobileNo').addClass("inp_select");
          if($('#mobileNo').val() == '支持全国移动联通电信'){
        	  $('#mobileNo').val('');
           } 
     }).keypress(function(e){
    	 var keyCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
    	 if(keyCode == 13){
        	  if($('#bossType_temp').val() == ""){
        		   eval($('#mobileNo').keyup());
        		  return false;
              }else{
                   return true;
              }
              
         }            
     });

});


 function strToObject(){
	  var str  = arguments[0];
	  str  = str.substring(1,str.length-1);
	  var datas = str.split(',');
	  var mobileSegment = new Object();
	  for(var i=0;i<datas.length;i++){
		 var  data = datas[i].split('=');
		 mobileSegment[trimAll(data[0])] = trimAll(data[1]);
	 }
	 
	  return mobileSegment;
}
 //load product
 function loadMobileProduct(){
	   
	  if($('#bossType').val() != "" && $('#bossType').val() != null){
		  $('#mobile_product_list').load("${rc.contextPath}/mobile_product.htm",{'bossType':$('#bossType').val()});
	  }else{
		
		  $('#mobile_product_list').load("${rc.contextPath}/mobile_product.htm"); 
	  } 
	  
	 
 }
 function loadDiscount(){
	 
	   var  str = "&chargeAmount="+$('#chargeAmount').val();
	   if($('#bossType').val()!=""){
               str +="&bossType="+$('#bossType').val();
	    }
	
      $.ajax({
   	     type:"GET",
         url:"${rc.contextPath}/mobile_product.htm?method=getDiscountBychargeAmount"+str,
         dataType:"JSON",
         success:function(data){
             if( data == 'nonsupport'){
                 $('#show_amount').html('暂不支持');
              }
             else {
            	 $('#amount_yuan').html(" 元");
            	 $('#show_amount').html(data*1);
                 $('#amount').val(data*1);
              }
             }
      }) 
 }

 
 // 
 function trimAll(str) {
	  re = /\s+/gi;
	  str = str.replace(re,"");
	  return str
  }
 function sm_r(data){
	  var msg = "";
     if(data != null && data !="null"){
 	     var mobileSegment = strToObject(data);
 	     msg=mobileSegment['provinceName'];
 	     //save bossType
 	     $('#bossType').val(mobileSegment['bossType']);
 	    $('#bossType_temp').val(mobileSegment['bossType']);
 	    //provinceCode
  	     $('#provinceCode').val(mobileSegment['provinceCode']);
  	     
           switch(mobileSegment['bossType'])
     	    {
     	    case '0':
     	    	msg+="移动";
         	     break;
     	    case '1':
     	    	msg+="联通";
     	    	break;
     	    default:
     	    	msg+="电信";
          }
 	 }
  	 return msg;
	  
 }

 
 //check form 
 $('#submitForm').click(function(){

	 //mobile no
     var mobile_no=$('#mobileNo').val();
      
     if($('#mobile_address').html()=="暂不支持"){
           return false;
      }
     // is null
     if(trimAll(mobile_no) =="" || $('#mobileNo').val() == '支持全国移动联通电信'){
    	 $('#mobileNo_error').css({display:"block"});
    	 $('#mobile_address').html({display:"none"});
   	     $('#mobileNo_error').html('手机号码必须填写');
   	     return false;            
     }else{
    	 
          //pattern
           var reg = /[0-9]{11}/; 
           if(!reg.test(mobile_no)){
        	   $('#mobileNo_error').css({display:"block"});
          	   $('#mobile_address').html({display:"none"});
	       	   $('#mobileNo_error').html('手机号码格式错误');
	       	   return false;
       	   }
     }
		//alert("tt");
	  $('#command').submit();
	 //submitForm();
});


 
</script>


<!doctype html>
<html>
<head>
<meta charset="utf-8">

<!-- 禁止iphone初始规模 -->
<meta name="viewport" content="width=device-width; initial-scale=1.0">

<title>设置登录密码</title>

<!-- main css -->
<link href="<@sp.static/>/wechat/style/style.css" rel="stylesheet" type="text/css">
<!-- media queries css -->
<link href="<@sp.static/>/wechat/style/media-queries.css" rel="stylesheet" type="text/css">

<!-- html5.js for IE less than 9 -->
<!--[if lt IE 9]>
	<script src="<@sp.static/>/wechat/scripts/html5.js"></script>
<![endif]-->

<!-- css3-mediaqueries.js for IE less than 9 -->
<!--[if lt IE 9]>
	<script src="<@sp.static/>/wechat/scripts/css3-mediaqueries.js"></script>
<![endif]-->

<script type="text/javascript" src="<@sp.static/>/wechat/scripts/jquery-1.8.3.js"></script>

<style type="text/css">
	/*绘制登录密码Sar*/
	*{box-sizing:border-box;}
	.num_pwd_real{height:40px;margin-bottom:20px;}
	.num_pwd_inner{margin:0 auto;width:80%;height:40px;}
	.pwd_four_one{float:left;width:20%;height:40px;width:40px;text-align:center;line-height:50px;border:1px solid #75BCE4;font-size:36px;font-weight:bold;color:#0987D0;background:#F2F2F2;}
	
	.num_pwd_row{margin:0 auto;width:300px;height:60px;margin-bottom:20px;}
	.num_pwd_col{float:left;cursor:pointer;height:60px;width:60px;text-align:center;line-height:60px;background:#F2F2F2;border:1px solid #B8B8B8;border-radius:30px;-moz-border-radius:30px;-webkit-border-radius:30px;font-size:36px;font-weight:bold;color:#0987D0;}
	/*绘制登录密码结束*/
	a:active{color:red;}
	
</style>
<script type="text/javascript">
	$(function(){
		$("#clickGoBack").click(function(){
			window.history.go(-1) ;
		}) ;
	});
</script>
</head>

<body>
    <div id="pagewrap" >
    	<div id="content" >
            <!-- 头部提示 -->
            <div class="tip_title">
                <div class="tip_title_top"></div>
                <div class="tip_title_center">
                	<div style="width:15%;min-width:111px;height:52px;float:left;" id="clickGoBack">
                    	<div class="go_back" style="float:left;padding-top:3px;">
                            <!-- <img src="images/jt.png"/> -->
                        </div>
                    </div>
                    <div id="tt" style="">
                        <h2 style="line-height:52px;margin:auto;color:#FFFFFF;padding-right:55px;">设置登录密码</h2>
                    </div>
                </div>
                <div class="tip_title_bottom"></div>
            </div>
            
            <!--  -->
            <div id="hid" style="display:none;">
            	<input type="hidden" name="" id="hidV1"/>
                <input type="hidden" name="" id="hidV2"/>
                <input type="hidden" name="" id="hidV3"/>
                <input type="hidden" name="" id="hidV4"/>
            </div>
            <input type="hidden" name="" id="isFirstFlag" value="true"/>
        	<input type="hidden" name="" id="numpwd"/>
            <div style="" class="num_pwd_real">
                <div style="" class="num_pwd_inner">
                	<div style ="width:184px;margin:0 auto;">
                        <div class="pwd_four_one" id="first"></div>
                        <div class="pwd_four_one" id="second" style="margin:0 0 0 7px;"></div>
                        <div class="pwd_four_one" id="third" style="margin:0 7px;"></div>
                        <div class="pwd_four_one" id="fourth"></div>
                        <div style="clear:both;"></div>
                    </div>
                </div>
                <script type="text/javascript">
					$(function(){
						$(".num_pwd_inner").find("div.pwd_four_one").each(function(n, o) {
							if($(o).text() != ""){
								$("#num_pwd_again").css("display","block");
							}
						});
					});
                </script>
            </div>
            
            <div class="num_pwd_box">
            	
               	 <div class="num_pwd_row" style="">
                    <a class="num_pwd_col" style="">1</a>
                    <a class="num_pwd_col" style="margin:0 58px;">2</a>
                    <a class="num_pwd_col">3</a>
                </div> 
               
                 <div class="num_pwd_row" style="">
                    <a class="num_pwd_col" style="">4</a>
                    <a class="num_pwd_col" style="margin:0 60px;">5</a>
                    <a class="num_pwd_col">6</a>
                </div>
               <!-- <div class="num_pwd_row" style="">
                	<div class="num_pwd_col" style="">4</div>
                    <div class="num_pwd_col" style="margin:0 60px;">5</div>
                    <div class="num_pwd_col">6</div>
                </div>-->
                
                <div class="num_pwd_row" style="">
                    <a class="num_pwd_col" style="">7</a>
                    <a class="num_pwd_col" style="margin:0 60px;">8</a>
                    <a class="num_pwd_col">9</a>
                </div>
                
                <div class="num_pwd_row" style="">
                    <a class="num_pwd_col" style="border:none;background:none;">&nbsp;</a>
                    <a class="num_pwd_col" style="margin:0 60px;">0</a>
                    <div class="num_pwd_col" style="display:none;">&nbsp;</div>
                </div>
            </div>
            
            
            <!-- 下一步按钮 -->
            <div class="common_button" style="padding:1px;display:none;" id="num_pwd_again">
              <div style="width:42%;float:left;">&nbsp;</div>
              <div style="width:16%;float:left;">&nbsp;</div>
              <div style="width:42%;float:left;">&nbsp;</div>
              <span style="position:relative;top:-45px;">再画一次</span>
            </div>
            
        </div>
    </div>
	
    <script type="text/javascript">
    	$(function(){
			$(".num_pwd_col").click(function(){
				var thisV = $(this).text();
				var firstV = $("#first").text();
				if("" == firstV){
					$("#first").text("*");
					$("#hidV1").val(thisV) ;
					return false ;
				}
				var secondV = $("#second").text();
				if("" == secondV){
					$("#second").text("*");	
					$("#hidV2").val(thisV) ;
					return false ;
				}
				var thirdV = $("#third").text();
				if("" == thirdV){
					$("#third").text("*");
					$("#hidV3").val(thisV);
					return false ;
				}
				var fourthV = $("#fourth").text() ;
				if("" == fourthV){
					$("#fourth").text("*");	
					$("#hidV4").val(thisV) ;
					if($("#isFirstFlag").val() == "true"){
						$("#num_pwd_again").css("display", "block");//再画一次
					}else{
						//TODO   第一次和第二产次密码校验，保存到数据库，完成登录密码设置   
						numpwdConfirmVal = "" ;
						$("#hid").find("input").each(function(n, o) {
							numpwdConfirmVal += $(o).val();
							$(o).val("");
						});
						var getNumpwdVal = $("#numpwd").val() ;
						//验证
						if(getNumpwdVal != numpwdConfirmVal){
							alert("两次密码不一致，请重新设置！") ;	
							$("#isFirstFlag").val("true");//切换标志
							//清空
							$("#numpwd").val("");			//第一次记录
							$(".pwd_four_one").text("");	//输入记录
							
						}else{
							<#if resetDpwd?has_content>
								//window.location.href = "${rc.contextPath}/resetDpwdOK.htm" ;
								$.ajax({
									type:'POST',
									url:'${rc.contextPath}/doResetDpwd.htm?dpwd=' + numpwdConfirmVal,
									success:function(data){
										if(data == "resetOk")
											window.location.href = "${rc.contextPath}/resetDpwdOk.htm" ;
									}
								}) ;
								
								
								<#else>
									//TODO 设置登录密码 保存
									$.ajax({
										type:'POST',
										url:'${rc.contextPath}/corp/toMerQueValidate.htm',
										//data:{},
										success:function(data){
											if(data == 0){
												window.location.href = "${rc.contextPath}/corp/toMerQueValidate.htm?dpwd=" + numpwdConfirmVal ;
											}
										},
										error:function(){
											alert("网络服务出错了！") ;
										}
									});
							</#if>
							
						}
					}
					return false ;
				}
			});
		});
		
		$(function(){
			$("#num_pwd_again").click(function(){
				$("#isFirstFlag").val("isNotTrue");//切换标志
				$("#num_pwd_again").css("display","none"); //隐藏
				var numpwdVal = "";
				$("#hid").find("input").each(function(n, o) {
                    numpwdVal += $(o).val();
					$(o).val("");
                });
				$("#numpwd").val(numpwdVal); //记录
				$(".pwd_four_one").text("");//清空，为下一步准备
			});
		});
		
    </script>
    
</body>
</html>
